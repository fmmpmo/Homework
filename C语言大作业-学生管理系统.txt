/*
    项目名称：学生成绩管理系统
    该管理系统主要服务对象是老师等教职工人员。
    可选择的操作有学生成绩输入、修改、查询、删除、排名等。
    温馨提示：学生成绩十分重要，希望您的每一次操作都公平公正、认真进行，感谢您的使用！
    程序检验时间：2019/12/30
    祝您“旅途愉快”
*/

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <math.h>

typedef struct studentrecord
{
    char Num[15];        /*学号存储*/
    char Name[20];       /*姓名存储*/
    int age;             /*年龄存储*/
    float math;          /*数学成绩存储*/
    float English;       /*英语成绩存储*/
    float physics;       /*物理成绩存储*/
} SR;

FILE *fp;/*定义一个名为fp的文件指针（全局），在本程序中的任何一个位置都可以应用，
            用于文件打开关闭等操作
         */

void Input();           /*Input()函数原型声明*/
void ChangeByName();    /*ChangeByName()函数原型声明*/
void ChangeByNum();     /*ChangeByNum()函数原型声明*/
void Delete();          /*Delete()函数原型声明*/
void SearchName();      /*SearchName()函数原型声明*/
void SearchNum();       /*SearchNum()函数原型声明*/
void SumSort();         /*SumSort()函数原型声明*/
void CourseSort();      /*CourseSort()函数原型声明*/
void DeleteAll();       /*DeleteAll()函数原型声明*/
void Lookthrough();     /*Lookthrough()函数原型声明*/
int main()
{
    int a;
    while(1)
    {
        printf("\n***欢迎进入学生成绩管理系统，祝您旅途愉快***\n");
        printf("==============================================\n");
        printf("\n");
        printf("温馨提示：有效输入范围是0-10哦！\n");
        printf("1.学生成绩输入\n");
        printf("2.通过学号修改学生成绩\n");
        printf("3.通过姓名修改学生成绩\n");
        printf("4.学生成绩信息删除\n");
        printf("5.按学号查询学生成绩\n");
        printf("6.按姓名查询学生成绩\n");
        printf("7.总成绩排序\n");
        printf("8.单科成绩排序\n");
        printf("9.删除所有信息\n");
        printf("10.浏览学生信息\n");
        printf("0.退出\n");
        printf("--------------------------------------\n");
        printf("请选择您想要进行的操作：");
        scanf("%d",&a);
        getchar();
        printf("\n");
        if(a==1)
        {
            Input();
        }
        else if(a==2)
        {
            ChangeByNum();
        }
        else if(a==3)
        {
            ChangeByName();
        }
        else if(a==4)
        {
            Delete();
        }
        else if(a==5)
        {
            SearchNum();
        }
        else if(a==6)
        {
            SearchName();
        }
        else if(a==7)
        {
            SumSort();
        }
        else if(a==8)
        {
            CourseSort();
        }
        else if(a==9)
        {
            DeleteAll();
        }
        else if(a==10)
        {
            Lookthrough();
        }
        else
        {
            printf("已退出！\n");
            printf("感谢您的使用！");
            return 0;
        }
        printf("\n已返回！\n");
    }
    return 0;
}

/*函数功能：输入学生成绩*/
void Input()
{
    SR x;       /*定义一个结构体变量*/
    printf("请输入学生信息：");
    printf("学号：");
    gets(x.Num);
    printf("                姓名：");
    gets(x.Name);
    printf("                年龄：");
    scanf("%d",&x.age);
    getchar();
    printf("                数学成绩：");
    scanf("%f",&x.math);
    getchar();
    printf("                英语成绩：");
    scanf("%f",&x.English);
    getchar();
    printf("                物理成绩：");
    scanf("%f",&x.physics);
    getchar();
    fp=fopen("wbc.txt","ab");
    if(fp==NULL)
    {
        printf("打开失败！\n");
    }
    else
    {
        fprintf(fp,"%s %s %d %.0f %.0f %.0f %c %c",x.Num,x.Name,x.age,x.math,x.English,x.physics,' ',' ');
        printf("输入成功！\n");
    }
    fclose(fp);
}
/*函数功能：通过学号搜索修改学生成绩*/
void ChangeByNum()
{
    SR x;
    FILE *fp2;
    int flag;
    char str[15];
    printf("请输入想修改的学生学号：");
    gets(str);
    fp=fopen("wbc.txt","rb");
    fp2=fopen("qzl.txt","wb");
    flag=0;
    if(fp==NULL||fp2==NULL)
    {
        printf("打开失败！\n");
    }
    else
    {
        while(fscanf(fp,"%s %s %d %f %f %f",x.Num,x.Name,&x.age,&x.math,&x.English,&x.physics)!=EOF)
        {
            if(strcmp(str,x.Num)==0)
            {
                printf("重新输入学生信息：");
                printf("学号：");
                gets(x.Num);
                printf("                  姓名：");
                gets(x.Name);
                printf("                  年龄：");
                scanf("%d",&x.age);
                getchar();
                printf("                  数学成绩：");
                scanf("%f",&x.math);
                getchar();
                printf("                  英语成绩：");
                scanf("%f",&x.English);
                getchar();
                printf("                  物理成绩：");
                scanf("%f",&x.physics);
                getchar();
                flag=1;
            }
            fprintf(fp2,"%s %s %d %f %f %f %c %c",x.Num,x.Name,x.age,x.math,x.English,x.physics,' ',' ');
        }
    }

    if(flag==0)
    {
        printf("该学生成绩不存在或未录入！\n");
    }
    fclose(fp);
    fclose(fp2);
    remove("wbc.txt");
    rename("qzl.txt","wbc.txt");

    fclose(fp);
}
/*函数功能：通过姓名搜索修改学生成绩*/
void ChangeByName()
{
    SR x;
    FILE *fp2;
    int flag;
    char str[15];
    printf("请输入想修改的学生姓名：");
    gets(str);
    fp=fopen("wbc.txt","rb");
    fp2=fopen("qzl.txt","wb");
    flag=0;
    if(fp==NULL||fp2==NULL)
    {
        printf("打开失败！\n");
    }
    else
    {
        while(fscanf(fp,"%s %s %d %f %f %f",x.Num,x.Name,&x.age,&x.math,&x.English,&x.physics)!=EOF)
        {
            if(strcmp(str,x.Name)==0)
            {
                printf("重新输入学生信息：");
                printf("学号：");
                gets(x.Num);
                printf("                  姓名：");
                gets(x.Name);
                printf("                  年龄：");
                scanf("%d",&x.age);
                getchar();
                printf("                  数学成绩：");
                scanf("%f",&x.math);
                getchar();
                printf("                  英语成绩：");
                scanf("%f",&x.English);
                getchar();
                printf("                  物理成绩：");
                scanf("%f",&x.physics);
                getchar();
                flag=1;
            }
            fprintf(fp2,"%s %s %d %f %f %f %c %c",x.Num,x.Name,x.age,x.math,x.English,x.physics,' ',' ');
        }
    }
    if(flag==0)
    {
        printf("该学生成绩不存在或未录入！\n");
        }
        fclose(fp);
        fclose(fp2);
        remove("wbc.txt");
        rename("qzl.txt","wbc.txt");
    fclose(fp);
}
/*函数功能：删除学生成绩*/
void Delete()
{
    SR x;
    FILE *fp2;
    int flag;
    char str[15];
    printf("请输入想删除的学生学号：");
    gets(str);
    fp=fopen("wbc.txt","rb");
    fp2=fopen("qzl.txt","wb");
    flag=0;
    if(fp==NULL||fp2==NULL)
    {
        printf("打开失败！\n");
    }
    else
    {
        while(fscanf(fp,"%s %s %d %f %f %f",x.Num,x.Name,&x.age,&x.math,&x.English,&x.physics)!=EOF)
        {
            if(strcmp(str,x.Num)==0)
            {
                flag=1;
                continue;
            }
            fprintf(fp2,"%s %s %d %f %f %f %c",x.Num,x.Name,x.age,x.math,x.English,x.physics,' ');
        }
    }
    if(flag==0)
    {
        printf("信息不存在！\n");
    }
    else
    {
        printf("删除成功！\n");
    }
    fclose(fp);
    fclose(fp2);
    remove("wbc.txt");
    rename("qzl.txt","wbc.txt");
    fclose(fp);
}
/*函数功能：按学号查询学生个人成绩*/
void SearchNum()
{
    SR x;
    int flag;
    float sum;
    char str[15];
    printf("请输入想查找的学生学号：");
    gets(str);
    fp=fopen("wbc.txt","r");
    flag=0;
    if(fp==NULL)
    {
        printf("打开失败！\n");
    }
    else
    {
        while(fscanf(fp,"%s %s %d %f %f %f",x.Num,x.Name,&x.age,&x.math,&x.English,&x.physics)!=EOF)
        {
            if(strcmp(x.Num,str)==0)
            {
                printf("\n               您的成绩如下\n");
                sum=x.math+x.English+x.physics;
                printf("\n    学号       姓名      年龄  数学  英语  物理  总分\n");
                printf("%-15s%5s%6d%6.0f%6.0f%6.0f%7.0f\n",x.Num,x.Name,x.age,x.math,x.English,x.physics,sum);
                flag=1;
                break;
            }
        }
        if(flag==0)
        {
            printf("该学生成绩不存在或未录入！\n");
        }
    }
    fclose(fp);
}
/*函数功能：按姓名查询学生个人成绩*/
void SearchName()
{
    SR x;
    int flag;
    float sum;
    char str[15];
    printf("请输入想查找的学生姓名：");
    gets(str);
    fp=fopen("wbc.txt","r");
    flag=0;
    if(fp==NULL)
    {
        printf("打开失败！\n");
    }
    else
    {
        while(fscanf(fp,"%s %s %d %f %f %f",x.Num,x.Name,&x.age,&x.math,&x.English,&x.physics)!=EOF)
        {
            if(strcmp(x.Name,str)==0)
            {
                printf("\n               您的成绩如下\n");
                sum=x.math+x.English+x.physics;
                printf("\n    学号       姓名      年龄  数学  英语  物理  总分\n");
                printf("%-15s%5s%6d%6.0f%6.0f%6.0f%7.0f\n",x.Num,x.Name,x.age,x.math,x.English,x.physics,sum);
                flag=1;
                break;
            }
        }
        if(flag==0)
        {
            printf("该学生成绩不存在或未录入！\n");
        }
    }
    fclose(fp);
}
/*函数功能：总成绩排名*/
void SumSort()
{
    SR i,a[30],temp;
    int n,x,y;
    float sum;
    fp=fopen("wbc.txt","r");
    n=0;
    if(fp==NULL)
    {
        printf("打开失败！\n");
    }

    else
    {
        while(fscanf(fp,"%s %s %d %f %f %f",i.Num,i.Name,&i.age,&i.math,&i.English,&i.physics)!=EOF)
        {
            a[n]=i;      /*结构体整体直接赋值*/
            if(n>0 && strcmp(a[n].Num,a[n-1].Num)==0)
            {
                break;
            }
            n++;
        }
    }
    fclose(fp);
    for(x=0; x<n-1; x++)
    {
        for(y=x+1; y<=n-1; y++)
        {
            if(a[y].math+a[y].English+a[y].physics>a[x].math+a[x].English+a[x].physics)
            {
                temp=a[x];
                a[x]=a[y];
                a[y]=temp;
            }
        }
    }
    printf("学号         \t姓名\t年龄\t数学\t英语\t物理\t总分\t\n");
    for(x=0; x<=n-1; x++)
    {
        sum=a[x].math+a[x].English+a[x].physics;
        printf("%s\t%s\t%d\t%.0f\t%.0f\t%.0f\t%.0f\t\n",a[x].Num,a[x].Name,a[x].age,a[x].math,a[x].English,a[x].physics,sum);
    }
}
/*函数功能：按学号浏览学生成绩*/
void Lookthrough()
{
    SR i,a[30],temp;
    int n,x,y;
    float sum;
    fp=fopen("wbc.txt","r");
    n=0;
    if(fp==NULL)
    {
        printf("打开失败！\n");
    }

    else
    {
        while(fscanf(fp,"%s %s %d %f %f %f",i.Num,i.Name,&i.age,&i.math,&i.English,&i.physics)!=EOF)
        {
            a[n]=i;      /*结构体整体直接赋值*/
            if(n>0 && strcmp(a[n].Num,a[n-1].Num)==0)
            {
                break;
            }
            n++;
        }
    }
    fclose(fp);
    for(x=0; x<n-1; x++)
    {
        for(y=x+1; y<=n-1; y++)
        {
            if(strcmp(a[y].Num,a[x].Num)<0)
            {
                temp=a[x];
                a[x]=a[y];
                a[y]=temp;
            }
        }
    }
    printf("学号         \t姓名\t年龄\t数学\t英语\t物理\t总分\t\n");
    for(x=0; x<=n-1; x++)
    {
        sum=a[x].math+a[x].English+a[x].physics;
        printf("%s\t%s\t%d\t%.0f\t%.0f\t%.0f\t%.0f\t\n",a[x].Num,a[x].Name,a[x].age,a[x].math,a[x].English,a[x].physics,sum);
    }
}
/*函数功能：单科成绩排名*/
void CourseSort()
{
    int a,n,x,y;
    SR i,b[30],temp;
    printf("1.数学\n");
    printf("2.英语\n");
    printf("3.物理\n");
    printf("\n请选择排序科目：");
    scanf("%d",&a);
    getchar();
    fp=fopen("wbc.txt","rb");
    n=0;
    if(fp==NULL)
    {
        printf("打开失败！\n");
    }
    else
    {
        while(fscanf(fp,"%s %s %d %f %f %f",i.Num,i.Name,&i.age,&i.math,&i.English,&i.physics)!=EOF)
        {
            b[n]=i;
            if(n>0 &&strcmp(b[n].Num,b[n-1].Num)==0)
            {
                break;
            }
            n++;
        }
    }
    fclose(fp);
    if(a==1)
    {
        printf("\n    学号       姓名      年龄  数学\n");
        for(x=0; x<n-1; x++)
        {
            for(y=x+1; y<=n-1; y++)
            {
                if(b[y].math>b[x].math)
                {
                    temp=b[x];
                    b[x]=b[y];
                    b[y]=temp;
                }
            }
        }
        for(x=0; x<=n-1; x++)
        {
            printf("%-14s%5s%8d%8.0f\n",b[x].Num,b[x].Name,b[x].age,b[x].math);
        }
    }
    else if(a==2)
    {
        printf("\n    学号       姓名      年龄  英语\n");
        for(x=0; x<n-1; x++)
        {
            for(y=x+1; y<=n-1; y++)
            {
                if(b[y].English>b[x].English)
                {
                    temp=b[x];
                    b[x]=b[y];
                    b[y]=temp;
                }
            }
        }
        for(x=0; x<=n-1; x++)
        {
            printf("%-15s%5s%6d%6.0f\n",b[x].Num,b[x].Name,b[x].age,b[x].English);
        }
    }
    else if(a==3)
    {
        printf("\n    学号       姓名      年龄  物理\n");
        for(x=0; x<n-1; x++)
        {
            for(y=x+1; y<=n-1; y++)
            {
                if(b[y].physics>b[x].physics)
                {
                    temp=b[x];
                    b[x]=b[y];
                    b[y]=temp;
                }
            }
        }
        for(x=0; x<=n-1; x++)
        {
            printf("%-15s%5s%6d%6.0f\n",b[x].Num,b[x].Name,b[x].age,b[x].physics);
        }
    }
    else
    {
        printf("输入错误，请重新选择！\n");
    }
}
/*函数功能：删除所有信息*/
void DeleteAll()
{
    fp=fopen("wbc.txt","w");
    fclose(fp);
    printf("已删除全部信息！\n");
}


